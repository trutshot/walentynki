<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Walentynki üíò</title>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#fff0f5;
      min-height:100vh;
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .card{
      width:min(560px,92vw);
      background:white;
      border-radius:24px;
      box-shadow:0 12px 40px rgba(0,0,0,.12);
      padding:28px 24px;
      text-align:center;
      position:relative;
      z-index:2;
    }
    .q{
      font-size:22px;
      font-weight:800;
      margin:18px 0 22px;
    }
    .row{
      position:relative;
      height:84px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap:14px;
    }
    button{
      border:0;
      border-radius:999px;
      padding:14px 22px;
      font-size:18px;
      font-weight:800;
      cursor:pointer;
      box-shadow:0 10px 22px rgba(0,0,0,.12);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    #yes{ background:#ff2d55; color:#fff; }

    /* NIE ucieka transformem ‚Äì layout siƒô nie rusza */
    #no{
      background:#111827;
      color:#fff;
      will-change: transform;
      touch-action: none;
    }

    /* ekran po TAK */
    .after{ display:none; }
    .after.show{ display:block; }
    .title{
      font-size:22px;
      font-weight:900;
      margin:4px 0 14px;
    }

    .photo{
      margin:0 auto;
      width:min(460px,86vw);
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 16px 40px rgba(0,0,0,.18);
      background:#f3f4f6;
    }
    .photo img{ width:100%; display:block; }

    /* ‚ù§Ô∏è SERCA */
    .hearts{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:1;
    }
    .heart{
      position:absolute;
      font-size:22px;
      animation: fall linear forwards;
      opacity:0.9;
    }
    @keyframes fall{
      from{
        transform: translateY(-40px) scale(1);
        opacity:0.9;
      }
      to{
        transform: translateY(110vh) scale(1.1);
        opacity:0.1;
      }
    }
  </style>
</head>
<body>

  <div class="card">
    <!-- PYTANIE -->
    <div id="askScreen">
      <h1>Hej, Olu≈õ üíò</h1>
      <div class="q">czy zostaniesz mojƒÖ walentynkƒÖ?</div>

      <div class="row" id="row">
        <button id="yes">TAK</button>
        <button id="no">NIE</button>
      </div>
    </div>

    <!-- PO TAK -->
    <div class="after" id="afterScreen">
      <div class="title">Bardzo siƒô cieszƒô, kocham Ciƒô! ‚ù§Ô∏è</div>
      <div class="photo"><img id="photo" alt="Zdjƒôcie"></div>
    </div>
  </div>

  <!-- SERCA -->
  <div class="hearts" id="hearts"></div>

  <!-- MUZYKA -->
  <audio id="loveSong" src="song.mp3" loop></audio>

  <script>
    const PHOTO_URL = "photo.jpg"; // albo URL do zdjƒôcia

    const yes = document.getElementById("yes");
    const no = document.getElementById("no");
    const row = document.getElementById("row");
    const askScreen = document.getElementById("askScreen");
    const afterScreen = document.getElementById("afterScreen");
    const photo = document.getElementById("photo");
    const hearts = document.getElementById("hearts");
    const card = document.querySelector(".card"); // obszar ucieczki

    photo.src = PHOTO_URL;

    /* ================== SERCA ================== */
    let heartsInterval = null;

    function spawnHeart(){
      const h = document.createElement("div");
      h.className = "heart";
      h.textContent = "‚ù§Ô∏è";

      const size = 16 + Math.random()*18;
      h.style.fontSize = size + "px";
      h.style.left = Math.random()*100 + "vw";
      h.style.animationDuration = (3 + Math.random()*3) + "s";
      h.style.animationTimingFunction = "linear";

      hearts.appendChild(h);
      h.addEventListener("animationend", ()=>h.remove());
    }

    function startHearts(){
      if (heartsInterval) return;
      heartsInterval = setInterval(spawnHeart, 20);
    }

    /* ================== UCIEKAJƒÑCE NIE ================== */
    let base = null, tx = 0, ty = 0, lastMoveAt = 0;

    // Mniej agresywne parametry:
    const FEAR_RADIUS = 55;      // wcze≈õniej 120 (za szybko reagowa≈Ço)
    const THROTTLE_MS = 55;      // wolniej reaguje (mniej "teleport√≥w")
    const SAFE_MARGIN = 22;      // ≈ºeby nie lƒÖdowa≈Ç na ≈õcianie
    const JUMP_MIN = 130;        // mniejszy skok
    const JUMP_RAND = 140;       // mniejsza losowo≈õƒá
    const EDGE_BONUS = 18;       // lekkie "odepchniƒôcie" od ≈õcian

    function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }

    function computeBase(){
      const r = no.getBoundingClientRect();
      return {
        x:(r.left+r.width/2)-tx,
        y:(r.top+r.height/2)-ty,
        w:r.width,
        h:r.height
      };
    }

    function currentCenter(){
      if(!base) base = computeBase();
      return { x:base.x+tx, y:base.y+ty };
    }

    function setTranslate(x,y){
      tx=x; ty=y;
      no.style.transform=`translate(${tx}px,${ty}px)`;
      no.style.pointerEvents="none";
      setTimeout(()=>no.style.pointerEvents="",110);
    }

    function moveNoAway(mx,my){
      const now = performance.now();
      if (now - lastMoveAt < THROTTLE_MS) return;
      lastMoveAt = now;

      if(!base) base = computeBase();

      // obszar: karta, ale z marginesem ≈ºeby nie ko≈Ñczy≈Ç na ≈õcianie
      const area = card.getBoundingClientRect();
      const cur = currentCenter();

      let vx = cur.x - mx, vy = cur.y - my;
      if(Math.hypot(vx,vy) < 1){
        const a = Math.random()*Math.PI*2;
        vx = Math.cos(a); vy = Math.sin(a);
      }
      const len = Math.hypot(vx,vy);
      vx /= len; vy /= len;

      const jump = JUMP_MIN + Math.random()*JUMP_RAND;

      const halfW = base.w/2;
      const halfH = base.h/2;

      const minX = area.left + halfW + SAFE_MARGIN;
      const maxX = area.right - halfW - SAFE_MARGIN;
      const minY = area.top + halfH + SAFE_MARGIN;
      const maxY = area.bottom - halfH - SAFE_MARGIN;

      // 1) proponowany skok
      let x = cur.x + vx*jump;
      let y = cur.y + vy*jump;

      x = clamp(x, minX, maxX);
      y = clamp(y, minY, maxY);

      // 2) je≈õli wylƒÖdowa≈Ç blisko ≈õciany, lekko go "odsu≈Ñ" do ≈õrodka (≈ºeby nie ko≈Ñczy≈Ç na krawƒôdzi)
      if (x <= minX + 1) x += EDGE_BONUS;
      if (x >= maxX - 1) x -= EDGE_BONUS;
      if (y <= minY + 1) y += EDGE_BONUS;
      if (y >= maxY - 1) y -= EDGE_BONUS;

      // 3) je≈õli nadal za blisko kursora, wybierz najlepszy z kilku kr√≥tkich skok√≥w (bez teleportu na ≈õcianƒô)
      let bestX = x, bestY = y;
      let bestD = Math.hypot(x - mx, y - my);

      if (bestD < FEAR_RADIUS + 10) {
        for (let i=0;i<10;i++){
          const a = Math.random()*Math.PI*2;
          const xx = clamp(cur.x + Math.cos(a)*jump, minX, maxX);
          const yy = clamp(cur.y + Math.sin(a)*jump, minY, maxY);
          const d = Math.hypot(xx - mx, yy - my);
          if (d > bestD) { bestD = d; bestX = xx; bestY = yy; }
        }
        x = bestX; y = bestY;
      }

      setTranslate(x - base.x, y - base.y);
    }

    // Strefa aktywacji: karta (ale tylko gdy kursor jest w pobli≈ºu karty)
    document.addEventListener("pointermove", e => {
      const a = card.getBoundingClientRect();
      if (e.clientX < a.left-40 || e.clientX > a.right+40 || e.clientY < a.top-40 || e.clientY > a.bottom+40) return;

      const r = no.getBoundingClientRect();
      const d = Math.hypot((r.left + r.width/2) - e.clientX, (r.top + r.height/2) - e.clientY);
      if (d < FEAR_RADIUS) moveNoAway(e.clientX, e.clientY);
    });

    no.addEventListener("pointerenter", e => moveNoAway(e.clientX, e.clientY));
    no.addEventListener("touchstart", e => {
      const t = e.touches[0];
      e.preventDefault();
      moveNoAway(t.clientX, t.clientY);
    }, { passive:false });

    // resize: przelicz bazƒô, zachowujƒÖc transform
    window.addEventListener("resize", ()=>{
      if (no.style.display === "none") return;
      const oldTx = tx, oldTy = ty;

      no.style.transform = "translate(0px, 0px)";
      tx = 0; ty = 0;
      base = computeBase();

      setTranslate(oldTx, oldTy);
    });

    /* ================== TAK ================== */
    yes.addEventListener("click",()=>{
      askScreen.style.display="none";
      afterScreen.classList.add("show");
      no.style.display="none";

      const song = document.getElementById("loveSong");
      song.volume = 0.6;
      song.currentTime = 20;
      song.play();

      startHearts();
    });
  </script>
</body>
</html>
